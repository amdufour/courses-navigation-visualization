/*! project-name v0.0.1 | (c) 2021 YOUR NAME | MIT License | http://link-to-your-git-repo.com */
const svg=d3.select("#sankey").append("svg").attr("viewbox",[0,0,width,height]).attr("width",width).attr("height",height),sankey=d3.sankey().nodeSort(null).linkSort(null).nodeWidth(nodesWidth).nodePadding(nodesPadding).extent([[0,5],[width-svgPadding.left-svgPadding.right,height-svgPadding.top-svgPadding.bottom-5]]),createSankey=()=>{const{nodes:t,links:e}=sankey({nodes:graphData.nodes.map(t=>Object.assign({},t)),links:graphData.links.map(t=>Object.assign({},t))}),a=[];t.forEach(t=>{nodeByKey.forEach((e,l)=>{if(e.name===t.name){if("title"===l.slice(l.indexOf("[")+2).slice(0,l.indexOf(",")-3)){const e=t;e.id=data.find(e=>e.title[0]===t.name).id,a.push(e)}}})}),console.log("nodes",t),console.log("links",e),console.log("liveProjects",a),svg.append("g").attr("class","links-group").attr("fill","none").attr("width",width-svgPadding.left-svgPadding.right).attr("height",height-svgPadding.top-svgPadding.bottom).style("transform",`translate(${svgPadding.left}px, ${svgPadding.top}px)`).selectAll(".link-group").data(e).join("g").attr("class",t=>data.find(e=>e.title[0]===t.target.name)?`link-group link-to-title link-to-title-${data.find(e=>e.title[0]===t.target.name).difficulty}`:"link-group").append("path").attr("class",t=>`link link-${t.index} link-${t.source.index}-to-${t.target.index}`).attr("d",d3.sankeyLinkHorizontal()).attr("stroke",bluePale).attr("stroke-width",t=>t.width).append("title").text(t=>`${t.names.join(" â†’ ")}\n${t.value.toLocaleString()}`);const l=svg.append("g").attr("class","nodes-group").attr("width",width-svgPadding.left-svgPadding.right).attr("height",height-svgPadding.top-svgPadding.bottom).style("transform",`translate(${svgPadding.left}px, ${svgPadding.top}px)`).selectAll(".node");l.data(t.filter(t=>{let e="";return nodeByKey.forEach((a,l)=>{if(a.name===t.name){const t=l.slice(l.indexOf("[")+2);e=t.slice(0,l.indexOf(",")-3)}}),"title"!==e})).join("rect").attr("class",t=>`node node-${t.index}`).attr("x",t=>(getNodesHorizontalPosition(t.x0),t.x0)).attr("y",t=>t.y0).attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0);l.data(a).join("g").attr("class",t=>`node node-title node-${data.find(e=>e.title[0]===t.name).difficulty} node-${t.index}`).append("circle").attr("cx",t=>(getNodesHorizontalPosition(t.x0),t.x0)).attr("cy",t=>t.y0+(t.y1-t.y0)/2).attr("r",coursesCircleRadius);svg.append("g").attr("class","nodes-titles-group").attr("width",width-svgPadding.left-svgPadding.right).attr("height",height-svgPadding.top-svgPadding.bottom).style("transform",`translate(${svgPadding.left}px, ${svgPadding.top}px)`).selectAll(".node-label").data(t.filter(t=>{let e="";return nodeByKey.forEach((a,l)=>{if(a.name===t.name){const t=l.slice(l.indexOf("[")+2);e=t.slice(0,l.indexOf(",")-3)}}),"title"!==e})).join("text").attr("class",t=>`node-label node-label-${t.index} node-label-${keys[nodesXPositions.indexOf(t.x0+nodesPadding/2)].id}`).attr("x",t=>"title"===keys[nodesXPositions.indexOf(t.x0+nodesPadding/2)].id?t.x1-2:t.x1+6).attr("y",t=>(t.y1+t.y0)/2).attr("dy","0.35em").attr("text-anchor",t=>"start").text(t=>t.name),d3.selectAll(".link-to-title").append("linearGradient").attr("id",t=>`def-${t.source.index}-to-${t.target.index}`).attr("gradientUnits","userSpaceOnUse").attr("x1",t=>t.source.x1).attr("x2",t=>t.target.x0).append("stop").attr("offset","0%").attr("stop-color",bluePale),d3.selectAll(".link-to-title-BEGINNER linearGradient").append("stop").attr("offset","100%").attr("stop-color",beginner),d3.selectAll(".link-to-title-INTERMEDIATE linearGradient").append("stop").attr("offset","100%").attr("stop-color",intermediate),d3.selectAll(".link-to-title-ADVANCED linearGradient").append("stop").attr("offset","100%").attr("stop-color",advanced),d3.selectAll(".link-to-title path").attr("stroke",t=>`url(#def-${t.source.index}-to-${t.target.index})`),svg.append("g").attr("class","columns-labels").selectAll(".column-label").data(keys).join("text").attr("class","column-label").attr("x",t=>nodesXPositions[keys.indexOf(t)]+svgPadding.left).attr("text-anchor","middle").attr("y",20).text(t=>t.label);const i=d3.select(".live-projects").selectAll(".live-project").data(a).join("div").attr("class",t=>`live-project live-project-${t.index}`).style("width",`${svgPadding.right}px`).style("max-width",`${svgPadding.right}px`).style("transform",t=>`translateY(${t.y1+11}px)`).append("div").attr("class",t=>`live-project-toggle-wrapper live-project-toggle-wrapper-${t.index}`);i.append("h3").attr("id",t=>`live-project-title-${t.index}`).text(t=>t.name),i.append("div").attr("class","toggle");const d=d3.select(".live-projects-content").selectAll(".live-project-content").data(a).join("div").attr("class",t=>`live-project-content live-project-content-${t.index}`).style("width",`${svgPadding.right}px`).style("max-width",`${svgPadding.right}px`).style("transform",t=>`translateY(${t.y1+11}px)`),n=d.append("div").attr("class","info-section skills-learned-wrapper");n.append("div").attr("class","label").text("Skills learned"),n.append("ul").attr("class","skills-learned");const s=d.append("div").attr("class","info-section prerequesites-wrapper");function o(e){let a=d3.select(this).attr("class");a.includes("faded")&&(a=a.replace(" faded","")),a.includes("faded-hold")&&(a=a.replace(" faded-hold","")),a.includes("active")&&(a=a.replace(" active","")),a.includes("active-hold")&&(a=a.replace(" active-hold","")),a.includes("-hold")&&(a=a.replace("-hold",""));const l=t.find(t=>t.index===parseInt(a.slice(a.lastIndexOf("-")+1),10));l&&(isActiveElement||handleHighlight(l,t,"active",!0))}function r(e){let a=d3.select(this).attr("class");a.includes("faded")&&(a=a.replace(" faded","")),a.includes("faded-hold")&&(a=a.replace(" faded-hold","")),a.includes("active")&&(a=a.replace(" active","")),a.includes("active-hold")&&(a=a.replace(" active-hold","")),a.includes("-hold")&&(a=a.replace("-hold",""));const l=t.find(t=>t.index===parseInt(a.slice(a.lastIndexOf("-")+1),10));l&&(isActiveElement||handleHighlight(l,t,"active",!1))}s.append("div").attr("class","label").text("Prerequesites"),s.append("ul").attr("class","prerequesites"),d.append("div").attr("class","info-section level-wrapper").append("div").attr("class","label").text("Level"),data.forEach(t=>{const e=a.find(e=>e.id===t.id).index,l=d3.select(`.live-project-content-${e}`);t.skills_learned.split(", ").forEach(t=>{l.select(".skills-learned").append("li").text(t)}),t.skills_needed.split(", ").forEach(t=>{l.select(".prerequesites").append("li").text(t)}),l.select(".level-wrapper").append("div").attr("class","level").text(t.difficulty.toLowerCase())}),d.append("a").attr("href",t=>`${liveProjectsUri}${data.find(e=>e.title[0]===t.name).slug}`).attr("class","read-more").text("Buy this liveProject"),d3.selectAll(".node").on("mouseenter",o).on("mouseleave",r).on("click",(function(e){isActiveElement=!0;const a=d3.select(this).attr("class"),l=t.find(t=>t.index===parseInt(a.slice(a.lastIndexOf("-")+1),10));d3.selectAll(".node").classed("faded-hold",!0),l&&handleHighlight(l,t,"active-hold",!0)})),d3.selectAll(".live-project-toggle-wrapper").on("mouseenter",o).on("mouseleave",r)};